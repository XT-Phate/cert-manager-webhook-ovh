---
suite: Testing secret template with invalid values
templates:
- secret.yaml
tests:
- it: Should trigger error when issuer doesn't have application consumerKey reference
  values:
  - values/invalid_issuers/application-ref-without-consumer.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application consumerKey reference key
  values:
  - values/invalid_issuers/application-ref-without-consumer-key.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application consumerKey reference name
  values:
  - ./values/invalid_issuers/application-ref-without-consumer-name.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application key reference
  values:
  - ./values/invalid_issuers/application-ref-without-key.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application key reference key
  values:
  - ./values/invalid_issuers/application-ref-without-key-key.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application key reference name
  values:
  - ./values/invalid_issuers/application-ref-without-key-name.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application secret reference
  values:
  - ./values/invalid_issuers/application-ref-without-secret.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application secret reference key
  values:
  - ./values/invalid_issuers/application-ref-without-secret-key.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have application secret reference name
  values:
  - ./values/invalid_issuers/application-ref-without-secret-name.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer use both ovhAuthenticationRef and ovhAuthentication
  values:
  - ./values/invalid_issuers/both-auth-values-and-ref.yaml
  asserts:
  - failedTemplate:
      errorMessage: "Invalid issuer both-auth-values-and-ref: For each issuer you wish to create, you need to define either 'ovhAuthentication' or 'ovhAuthenticationRef'"

- it: Should trigger error when issuer doesn't have oauth2 clientID reference
  values:
  - ./values/invalid_issuers/oauth2-ref-without-client-id.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have oauth2 clientID reference key
  values:
  - ./values/invalid_issuers/oauth2-ref-without-client-id-key.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have oauth2 clientID reference name
  values:
  - ./values/invalid_issuers/oauth2-ref-without-client-id-name.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have oauth2 clientSecret reference
  values:
  - ./values/invalid_issuers/oauth2-ref-without-client-secret.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have oauth2 clientSecret reference key
  values:
  - ./values/invalid_issuers/oauth2-ref-without-client-secret-key.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer doesn't have oauth2 clientSecret reference name
  values:
  - ./values/invalid_issuers/oauth2-ref-without-client-secret-name.yaml
  asserts:
  - hasDocuments:
      count: 0

- it: Should trigger error when issuer use not available authentication method
  values:
  - ./values/invalid_issuers/wrong-authentication-method.yaml
  asserts:
  - hasDocuments:
      count: 0
