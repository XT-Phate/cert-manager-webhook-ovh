---
suite: Testing secret template
templates:
  - secret.yaml
values:
  - values/valid_issuers.yaml
tests:
  - it: Validate application secret
    documentSelector:
      path: metadata.name
      value: application-ovh-credentials
    asserts:
      - equal:
          path: data
          value:
            applicationKey: YXBwbGljYXRpb25LZXlWYWx1ZQ==
            applicationSecret: YXBwbGljYXRpb25TZWNyZXRWYWx1ZQ==
            applicationConsumerKey: YXBwbGljYXRpb25Db25zdW1lcktleVZhbHVl

  - it: Validate oauth2 secret
    documentSelector:
      path: metadata.name
      value: oauth2-ovh-credentials
    asserts:
      - equal:
          path: data
          value:
            oauth2ClientID: b2F1dGgyQ2xpZW50SUR2YWx1ZQ==
            oauth2ClientSecret: b2F1dGgyQ2xpZW50U2VjcmV0VmFsdWU=

  - it: Secret should not be generated when secret ref is defined
    asserts:
      - hasDocuments:
          count: 2
